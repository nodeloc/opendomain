{
  "permissions": {
    "allow": [
      "Bash(curl:*)",
      "Bash(PORT=8080 DB_HOST=localhost DB_PORT=5432 DB_USER=opendomain DB_PASSWORD=opendomain_password DB_NAME=opendomain DB_SSLMODE=disable REDIS_HOST=localhost REDIS_PORT=6379 JWT_SECRET=dev-secret-key timeout 5 ./bin/api:*)",
      "Bash(PGPASSWORD=opendomain_password psql:*)",
      "Read(//home/jungle/**)",
      "Bash(killall:*)",
      "Bash(timeout 30 tail:*)",
      "Bash(lsof:*)",
      "Bash(netstat:*)",
      "Bash(make build:*)",
      "WebFetch(domain:docs.nodeloc.com)",
      "Bash(docker ps:*)",
      "Bash(./bin/opendomain:*)",
      "Bash(/tasks)",
      "Bash(xargs kill:*)",
      "Bash(# Get a JWT token first - check what auth endpoint exists curl -s http://localhost:8000/api/domains/1/dns -H \"\"Content-Type: application/json\"\")",
      "Bash(TOKEN=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZW1haWwiOiJhZG1pbkBvcGVuZG9tYWluLmxvY2FsIiwiaXNfYWRtaW4iOnRydWUsImV4cCI6MTc3MDgyNTQ3NSwiaWF0IjoxNzcwODE4Mjc1fQ.SBBLds4LZWPbqnhySi_ocs50Av2Djo3KfWIb91wf8PU\")",
      "Bash(PGPASSWORD=opendomain psql:*)",
      "Bash(/home/jungle/OpenDomain/internal/handler/fossbilling_sync.go << 'EOF'\n\n// ListPendingDomains è·å–å¾…æ¿€æ´»åŸŸååˆ—è¡¨\n// @Summary è·å–å¾…æ¿€æ´»åŸŸååˆ—è¡¨\n// @Tags Admin\n// @Produce json\n// @Success 200 {object} map[string]interface{}\n// @Router /api/admin/pending-domains [get]\n// @Security Bearer\nfunc \\(h *FOSSBillingSyncHandler\\) ListPendingDomains\\(c *gin.Context\\) {\n\tvar pendingDomains []models.PendingDomain\n\tif err := h.db.Preload\\(\"RootDomain\"\\).Where\\(\"deleted_at IS NULL\"\\).Order\\(\"created_at DESC\"\\).Find\\(&pendingDomains\\).Error; err != nil {\n\t\tc.JSON\\(http.StatusInternalServerError, gin.H{\"error\": \"Failed to fetch pending domains\"}\\)\n\t\treturn\n\t}\n\n\tc.JSON\\(http.StatusOK, gin.H{\n\t\t\"pending_domains\": pendingDomains,\n\t}\\)\n}\n\n// DeletePendingDomain åˆ é™¤å¾…æ¿€æ´»åŸŸå\n// @Summary åˆ é™¤å¾…æ¿€æ´»åŸŸå\n// @Tags Admin\n// @Param id path int true \"Pending Domain ID\"\n// @Produce json\n// @Success 200 {object} map[string]interface{}\n// @Router /api/admin/pending-domains/{id} [delete]\n// @Security Bearer\nfunc \\(h *FOSSBillingSyncHandler\\) DeletePendingDomain\\(c *gin.Context\\) {\n\tid := c.Param\\(\"id\"\\)\n\n\tvar pendingDomain models.PendingDomain\n\tif err := h.db.First\\(&pendingDomain, id\\).Error; err != nil {\n\t\tc.JSON\\(http.StatusNotFound, gin.H{\"error\": \"Pending domain not found\"}\\)\n\t\treturn\n\t}\n\n\tif err := h.db.Delete\\(&pendingDomain\\).Error; err != nil {\n\t\tc.JSON\\(http.StatusInternalServerError, gin.H{\"error\": \"Failed to delete pending domain\"}\\)\n\t\treturn\n\t}\n\n\tc.JSON\\(http.StatusOK, gin.H{\n\t\t\"message\": \"Pending domain deleted successfully\",\n\t}\\)\n}\nEOF)",
      "Bash(/home/jungle/OpenDomain/.env.example << 'EOF'\n# Application\nAPP_ENV=development\nPORT=8000\nLOG_LEVEL=debug\nFRONTEND_URL=http://localhost:3001\n\nSITE_NAME=OpenDomain\nSITE_DESCRIPTION=Free Domain Registration Platform\n\n# Database \\(PostgreSQL\\)\nDB_HOST=localhost\nDB_PORT=5432\nDB_USER=opendomain\nDB_PASSWORD=your-database-password\nDB_NAME=opendomain\nDB_SSL_MODE=disable\n\n# Redis\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_PASSWORD=\nREDIS_DB=0\n\n# JWT\nJWT_SECRET=your-super-secret-jwt-key-change-this-in-production\nJWT_EXPIRES_IN=2\n\n# PowerDNS\nPOWERDNS_API_URL=http://localhost:8081\nPOWERDNS_API_KEY=your-powerdns-api-key\n\n# Email\nMAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_USER=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\nMAIL_FROM=noreply@opendomain.com\n\n# OAuth \\(Optional\\)\nGITHUB_CLIENT_ID=your-github-client-id\nGITHUB_CLIENT_SECRET=your-github-client-secret\n\nGOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com\nGOOGLE_CLIENT_SECRET=your-google-client-secret\n\nNODELOC_CLIENT_ID=your-nodeloc-client-id\nNODELOC_CLIENT_SECRET=your-nodeloc-client-secret\n\n# Scanner\nSCANNER_CONCURRENCY=10\nSCANNER_TIMEOUT=30\n\n# Security Scanning APIs \\(Optional\\)\nGOOGLE_SAFE_BROWSING_KEY=your-google-safe-browsing-api-key\nVIRUSTOTAL_API_KEY=your-virustotal-api-key\n\n# Default Nameservers\nDEFAULT_NS1=ns1.example.com\nDEFAULT_NS2=ns2.example.com\n\n# NodeLoc Payment \\(Optional\\)\nNODELOC_PAYMENT_ID=your-nodeloc-payment-id\nNODELOC_SECRET_KEY=your-nodeloc-secret-key\n\n# Telegram Bot \\(Optional\\)\nTELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11\nTELEGRAM_CHANNEL_ID=-1001234567890\n\n# FOSSBilling Integration \\(Optional\\)\nFOSSBILLING_ENABLED=false\nFOSSBILLING_URL=https://your-fossbilling-instance.com\nFOSSBILLING_ADMIN_API_KEY=your-fossbilling-admin-api-key\nEOF)",
      "Bash(/home/jungle/OpenDomain/opendomain.service << 'EOF'\n[Unit]\nDescription=OpenDomain - Free Domain Registration Platform\nAfter=network.target postgresql.service redis.service\n\n[Service]\nType=simple\nUser=www-data\nGroup=www-data\nWorkingDirectory=/var/www/opendomain\nEnvironmentFile=/var/www/opendomain/.env\nExecStart=/var/www/opendomain/opendomain\nRestart=always\nRestartSec=5\n\n# å®‰å…¨è®¾ç½®\nNoNewPrivileges=true\nPrivateTmp=true\nProtectSystem=strict\nProtectHome=true\nReadWritePaths=/var/www/opendomain/logs\n\n# æ—¥å¿—\nStandardOutput=journal\nStandardError=journal\nSyslogIdentifier=opendomain\n\n[Install]\nWantedBy=multi-user.target\nEOF)",
      "Bash(/home/jungle/OpenDomain/DEPLOY.md << 'EOF'\n# OpenDomain éƒ¨ç½²æŒ‡å—\n\n## å‰ç½®è¦æ±‚\n\n### æœåŠ¡å™¨ç¯å¢ƒ\n- **æ“ä½œç³»ç»Ÿ**: Linux \\(Ubuntu 20.04+ æˆ– CentOS 7+\\)\n- **CPU**: 2æ ¸ä»¥ä¸Š\n- **å†…å­˜**: 2GB ä»¥ä¸Š\n- **ç£ç›˜**: 20GB ä»¥ä¸Š\n\n### è½¯ä»¶ä¾èµ–\n- **Go**: 1.21+ \\([å®‰è£…æŒ‡å—]\\(https://golang.org/doc/install\\)\\)\n- **Node.js**: 18+ \\([å®‰è£…æŒ‡å—]\\(https://nodejs.org/\\)\\)\n- **PostgreSQL**: 13+ \\([å®‰è£…æŒ‡å—]\\(https://www.postgresql.org/download/\\)\\)\n- **Redis**: 6+ \\([å®‰è£…æŒ‡å—]\\(https://redis.io/download\\)\\)\n- **PowerDNS**: 4.5+ \\([å®‰è£…æŒ‡å—]\\(https://doc.powerdns.com/\\)\\)\n- **migrate**: ç”¨äºæ•°æ®åº“è¿ç§» \\([å®‰è£…æŒ‡å—]\\(https://github.com/golang-migrate/migrate\\)\\)\n\n---\n\n## å¿«é€Ÿéƒ¨ç½²\n\n### 1. å…‹éš†ä»£ç \n\n```bash\n# åˆ›å»ºé¡¹ç›®ç›®å½•\nsudo mkdir -p /var/www/opendomain\nsudo chown $USER:$USER /var/www/opendomain\n\n# å…‹éš†ä»£ç \ncd /var/www/opendomain\ngit clone https://github.com/your-username/opendomain.git .\n```\n\n### 2. é…ç½®ç¯å¢ƒå˜é‡\n\n```bash\n# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿\ncp .env.example .env\n\n# ç¼–è¾‘é…ç½®æ–‡ä»¶\nvim .env\n```\n\n**é‡è¦é…ç½®é¡¹**:\n```bash\n# åº”ç”¨é…ç½®\nAPP_ENV=production\nPORT=8000\nFRONTEND_URL=https://your-domain.com\n\n# æ•°æ®åº“é…ç½®\nDB_HOST=localhost\nDB_PORT=5432\nDB_USER=opendomain\nDB_PASSWORD=your-secure-password\nDB_NAME=opendomain\n\n# JWT å¯†é’¥ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰\nJWT_SECRET=your-super-secret-jwt-key-change-this\n\n# PowerDNS API\nPOWERDNS_API_URL=http://localhost:8081\nPOWERDNS_API_KEY=your-powerdns-api-key\n\n# é‚®ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰\nMAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_USER=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\n\n# Redisï¼ˆå¯é€‰ï¼‰\nREDIS_HOST=localhost\nREDIS_PORT=6379\n```\n\n### 3. åˆ›å»ºæ•°æ®åº“\n\n```bash\n# ç™»å½• PostgreSQL\nsudo -u postgres psql\n\n# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·\nCREATE DATABASE opendomain;\nCREATE USER opendomain WITH PASSWORD 'your-secure-password';\nGRANT ALL PRIVILEGES ON DATABASE opendomain TO opendomain;\n\\\\q\n```\n\n### 4. å®‰è£… migrate å·¥å…·\n\n```bash\n# Linux x64\ncurl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.0/migrate.linux-amd64.tar.gz | tar xvz\nsudo mv migrate /usr/local/bin/\nsudo chmod +x /usr/local/bin/migrate\n```\n\n### 5. è¿è¡Œéƒ¨ç½²è„šæœ¬\n\n```bash\nchmod +x deploy.sh\n./deploy.sh\n```\n\néƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š\n1. æ‹‰å–æœ€æ–°ä»£ç \n2. å®‰è£… Go ä¾èµ–\n3. ç¼–è¯‘åç«¯ç¨‹åº\n4. è¿è¡Œæ•°æ®åº“è¿ç§»\n5. å®‰è£…å‰ç«¯ä¾èµ–\n6. æ„å»ºå‰ç«¯åº”ç”¨\n7. é‡å¯æœåŠ¡ï¼ˆå¦‚æœå·²è¿è¡Œï¼‰\n\n---\n\n## Systemd æœåŠ¡é…ç½®ï¼ˆæ¨èï¼‰\n\n### 1. åˆ›å»ºæœåŠ¡æ–‡ä»¶\n\n```bash\nsudo cp opendomain.service /etc/systemd/system/\nsudo vim /etc/systemd/system/opendomain.service\n```\n\nä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š\n- `User`: è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ï¼ˆå»ºè®®ä½¿ç”¨ www-data æˆ–åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼‰\n- `Group`: è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ç»„\n- `WorkingDirectory`: é¡¹ç›®ç›®å½•è·¯å¾„\n- `EnvironmentFile`: .env æ–‡ä»¶è·¯å¾„\n- `ExecStart`: opendomain å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„\n\n### 2. åˆ›å»ºæ—¥å¿—ç›®å½•\n\n```bash\nmkdir -p logs\n```\n\n### 3. å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\n\n```bash\n# é‡æ–°åŠ è½½ systemd é…ç½®\nsudo systemctl daemon-reload\n\n# å¯ç”¨å¼€æœºè‡ªå¯\nsudo systemctl enable opendomain\n\n# å¯åŠ¨æœåŠ¡\nsudo systemctl start opendomain\n\n# æŸ¥çœ‹æœåŠ¡çŠ¶æ€\nsudo systemctl status opendomain\n\n# æŸ¥çœ‹æ—¥å¿—\nsudo journalctl -u opendomain -f\n```\n\n---\n\n## Nginx åå‘ä»£ç†é…ç½®\n\n### 1. å®‰è£… Nginx\n\n```bash\nsudo apt install nginx  # Ubuntu/Debian\nsudo yum install nginx  # CentOS\n```\n\n### 2. åˆ›å»ºé…ç½®æ–‡ä»¶\n\n```bash\nsudo vim /etc/nginx/sites-available/opendomain\n```\n\n**é…ç½®ç¤ºä¾‹**:\n\n```nginx\nserver {\n    listen 80;\n    server_name your-domain.com;\n\n    # é‡å®šå‘åˆ° HTTPS\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name your-domain.com;\n\n    # SSL è¯ä¹¦é…ç½®\n    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;\n\n    # å‰ç«¯é™æ€æ–‡ä»¶\n    location / {\n        root /var/www/opendomain/web/dist;\n        try_files $uri $uri/ /index.html;\n        \n        # ç¼“å­˜é™æ€èµ„æº\n        location ~* \\\\.\\(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot\\)$ {\n            expires 1y;\n            add_header Cache-Control \"public, immutable\";\n        }\n    }\n\n    # API åå‘ä»£ç†\n    location /api/ {\n        proxy_pass http://localhost:8000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # WebSocket æ”¯æŒ\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n    }\n\n    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶\n    client_max_body_size 10M;\n}\n```\n\n### 3. å¯ç”¨é…ç½®\n\n```bash\n# åˆ›å»ºè½¯é“¾æ¥\nsudo ln -s /etc/nginx/sites-available/opendomain /etc/nginx/sites-enabled/\n\n# æµ‹è¯•é…ç½®\nsudo nginx -t\n\n# é‡å¯ Nginx\nsudo systemctl restart nginx\n```\n\n### 4. é…ç½® SSLï¼ˆLet's Encryptï¼‰\n\n```bash\n# å®‰è£… Certbot\nsudo apt install certbot python3-certbot-nginx\n\n# è·å–è¯ä¹¦\nsudo certbot --nginx -d your-domain.com\n\n# è‡ªåŠ¨ç»­æœŸæµ‹è¯•\nsudo certbot renew --dry-run\n```\n\n---\n\n## æ‰‹åŠ¨å¯åŠ¨ï¼ˆä¸ä½¿ç”¨ Systemdï¼‰\n\nå¦‚æœä¸æƒ³ä½¿ç”¨ systemdï¼Œå¯ä»¥æ‰‹åŠ¨å¯åŠ¨ï¼š\n\n```bash\n# åå°è¿è¡Œ\nnohup ./opendomain > logs/app.log 2>&1 &\n\n# æŸ¥çœ‹æ—¥å¿—\ntail -f logs/app.log\n\n# åœæ­¢æœåŠ¡\npkill -f opendomain\n```\n\n---\n\n## æ›´æ–°éƒ¨ç½²\n\nåç»­æ›´æ–°åªéœ€è¿è¡Œï¼š\n\n```bash\ncd /var/www/opendomain\n./deploy.sh\n```\n\n---\n\n## å¸¸è§é—®é¢˜\n\n### 1. æ•°æ®åº“è¿æ¥å¤±è´¥\n\næ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š\n```bash\nsudo systemctl status postgresql\n```\n\næ£€æŸ¥æ•°æ®åº“é…ç½®ï¼š\n```bash\npsql -h localhost -U opendomain -d opendomain\n```\n\n### 2. ç«¯å£è¢«å ç”¨\n\næŸ¥çœ‹ç«¯å£å ç”¨ï¼š\n```bash\nsudo netstat -tulpn | grep :8000\n```\n\nä¿®æ”¹ `.env` ä¸­çš„ `PORT` é…ç½®ã€‚\n\n### 3. æƒé™é—®é¢˜\n\nç¡®ä¿è¿è¡Œç”¨æˆ·å¯¹é¡¹ç›®ç›®å½•æœ‰è¯»å†™æƒé™ï¼š\n```bash\nsudo chown -R www-data:www-data /var/www/opendomain\nsudo chmod -R 755 /var/www/opendomain\n```\n\n### 4. å‰ç«¯æ„å»ºå¤±è´¥\n\næ¸…é™¤ node_modules é‡æ–°å®‰è£…ï¼š\n```bash\ncd web\nrm -rf node_modules package-lock.json\nnpm install\nnpm run build\n```\n\n### 5. æ•°æ®åº“è¿ç§»å¤±è´¥\n\næ‰‹åŠ¨è¿è¡Œè¿ç§»ï¼š\n```bash\nexport $\\(cat .env | grep -v '^#' | xargs\\)\nmigrate -path ./migrations -database \"postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=${DB_SSL_MODE}\" up\n```\n\n---\n\n## ç›‘æ§å’Œç»´æŠ¤\n\n### æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—\n\n```bash\n# systemd æ—¥å¿—\nsudo journalctl -u opendomain -f\n\n# åº”ç”¨æ—¥å¿—\ntail -f logs/app.log\n\n# Nginx æ—¥å¿—\ntail -f /var/log/nginx/access.log\ntail -f /var/log/nginx/error.log\n```\n\n### æ•°æ®åº“å¤‡ä»½\n\n```bash\n# å¤‡ä»½æ•°æ®åº“\npg_dump -U opendomain opendomain > backup_$\\(date +%Y%m%d\\).sql\n\n# æ¢å¤æ•°æ®åº“\npsql -U opendomain opendomain < backup_20240101.sql\n```\n\n### æ€§èƒ½ç›‘æ§\n\n```bash\n# æŸ¥çœ‹è¿›ç¨‹èµ„æºå ç”¨\nhtop\n\n# æŸ¥çœ‹è¿æ¥æ•°\nsudo netstat -ant | grep :8000 | wc -l\n\n# æŸ¥çœ‹æ•°æ®åº“è¿æ¥\nsudo -u postgres psql -c \"SELECT * FROM pg_stat_activity;\"\n```\n\n---\n\n## å®‰å…¨å»ºè®®\n\n1. **é˜²ç«å¢™é…ç½®**\n   ```bash\n   sudo ufw allow 22/tcp      # SSH\n   sudo ufw allow 80/tcp      # HTTP\n   sudo ufw allow 443/tcp     # HTTPS\n   sudo ufw enable\n   ```\n\n2. **å®šæœŸæ›´æ–°**\n   ```bash\n   sudo apt update && sudo apt upgrade\n   ```\n\n3. **æœ€å°æƒé™åŸåˆ™**\n   - ä¸è¦ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œåº”ç”¨\n   - é™åˆ¶æ–‡ä»¶æƒé™\n\n4. **å¤‡ä»½ç­–ç•¥**\n   - å®šæœŸå¤‡ä»½æ•°æ®åº“\n   - å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶\n   - å®šæœŸå¤‡ä»½ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶\n\n5. **ç›‘æ§å‘Šè­¦**\n   - é…ç½®ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Prometheus + Grafanaï¼‰\n   - é…ç½®æ—¥å¿—åˆ†æï¼ˆå¦‚ ELK Stackï¼‰\n   - é…ç½®å‘Šè­¦é€šçŸ¥\n\n---\n\n## æŠ€æœ¯æ”¯æŒ\n\n- **æ–‡æ¡£**: https://github.com/your-username/opendomain\n- **é—®é¢˜åé¦ˆ**: https://github.com/your-username/opendomain/issues\nEOF)",
      "Bash(/home/jungle/OpenDomain/nginx.conf.example << 'EOF'\n# OpenDomain Nginx é…ç½®ç¤ºä¾‹\n# ä½¿ç”¨æ–¹æ³•:\n# 1. å¤åˆ¶åˆ° /etc/nginx/sites-available/opendomain\n# 2. ä¿®æ”¹ your-domain.com ä¸ºä½ çš„åŸŸå\n# 3. é…ç½® SSL è¯ä¹¦è·¯å¾„\n# 4. åˆ›å»ºè½¯é“¾æ¥: sudo ln -s /etc/nginx/sites-available/opendomain /etc/nginx/sites-enabled/\n# 5. æµ‹è¯•é…ç½®: sudo nginx -t\n# 6. é‡å¯ Nginx: sudo systemctl restart nginx\n\n# HTTP -> HTTPS é‡å®šå‘\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name your-domain.com www.your-domain.com;\n\n    # ACME challenge for Let's Encrypt\n    location /.well-known/acme-challenge/ {\n        root /var/www/certbot;\n    }\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS é…ç½®\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name your-domain.com www.your-domain.com;\n\n    # SSL è¯ä¹¦ï¼ˆä½¿ç”¨ Let's Encryptï¼‰\n    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;\n\n    # SSL å®‰å…¨é…ç½®\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    # å®‰å…¨å¤´\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # æ—¥å¿—\n    access_log /var/log/nginx/opendomain_access.log;\n    error_log /var/log/nginx/opendomain_error.log;\n\n    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶\n    client_max_body_size 10M;\n\n    # å‰ç«¯é™æ€æ–‡ä»¶\n    location / {\n        root /var/www/opendomain/web/dist;\n        index index.html;\n        try_files $uri $uri/ /index.html;\n\n        # é™æ€èµ„æºç¼“å­˜\n        location ~* \\\\.\\(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp\\)$ {\n            expires 1y;\n            add_header Cache-Control \"public, immutable\";\n        }\n\n        # HTML æ–‡ä»¶ä¸ç¼“å­˜\n        location ~* \\\\.html$ {\n            expires -1;\n            add_header Cache-Control \"no-store, no-cache, must-revalidate\";\n        }\n    }\n\n    # API åå‘ä»£ç†åˆ°åç«¯\n    location /api/ {\n        proxy_pass http://127.0.0.1:8000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket æ”¯æŒ\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n\n        # è¶…æ—¶è®¾ç½®\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # å¥åº·æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰\n    location /health {\n        proxy_pass http://127.0.0.1:8000/health;\n        access_log off;\n    }\n\n    # é˜»æ­¢è®¿é—®éšè—æ–‡ä»¶\n    location ~ /\\\\. {\n        deny all;\n        access_log off;\n        log_not_found off;\n    }\n}\nEOF)",
      "Bash(/home/jungle/OpenDomain/QUICKSTART.md << 'EOF'\n# å¿«é€Ÿå¼€å§‹æŒ‡å—\n\n## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²ï¼ˆ30åˆ†é’Ÿå®Œæˆï¼‰\n\n### æ­¥éª¤ 1: ç¯å¢ƒå‡†å¤‡\n\n```bash\n# æ›´æ–°ç³»ç»Ÿ\nsudo apt update && sudo apt upgrade -y\n\n# å®‰è£… Go 1.21+\nwget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz\nsudo tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz\necho 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc\nsource ~/.bashrc\n\n# å®‰è£… Node.js 18+\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n\n# å®‰è£… PostgreSQL\nsudo apt install -y postgresql postgresql-contrib\n\n# å®‰è£… Redis\nsudo apt install -y redis-server\n\n# å®‰è£… Nginx\nsudo apt install -y nginx\n\n# å®‰è£… migrate\ncurl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.0/migrate.linux-amd64.tar.gz | tar xvz\nsudo mv migrate /usr/local/bin/\n```\n\n### æ­¥éª¤ 2: å…‹éš†é¡¹ç›®\n\n```bash\nsudo mkdir -p /var/www/opendomain\nsudo chown $USER:$USER /var/www/opendomain\ncd /var/www/opendomain\ngit clone https://github.com/your-username/opendomain.git .\n```\n\n### æ­¥éª¤ 3: é…ç½®æ•°æ®åº“\n\n```bash\n# åˆ›å»ºæ•°æ®åº“\nsudo -u postgres psql << SQL\nCREATE DATABASE opendomain;\nCREATE USER opendomain WITH PASSWORD 'your-password-here';\nGRANT ALL PRIVILEGES ON DATABASE opendomain TO opendomain;\n\\\\q\nSQL\n```\n\n### æ­¥éª¤ 4: é…ç½®ç¯å¢ƒå˜é‡\n\n```bash\n# å¤åˆ¶é…ç½®æ–‡ä»¶\ncp .env.example .env\n\n# ç¼–è¾‘é…ç½®ï¼ˆä¿®æ”¹æ•°æ®åº“å¯†ç ã€JWTå¯†é’¥ç­‰ï¼‰\nvim .env\n```\n\n**å¿…é¡»ä¿®æ”¹çš„é…ç½®**:\n- `DB_PASSWORD`: æ•°æ®åº“å¯†ç \n- `JWT_SECRET`: JWTå¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰\n- `FRONTEND_URL`: ä½ çš„åŸŸå\n- `POWERDNS_API_KEY`: PowerDNS APIå¯†é’¥\n\n### æ­¥éª¤ 5: ä¸€é”®éƒ¨ç½²\n\n```bash\nchmod +x deploy.sh\n./deploy.sh\n```\n\n### æ­¥éª¤ 6: é…ç½® Systemd æœåŠ¡\n\n```bash\n# ä¿®æ”¹æœåŠ¡æ–‡ä»¶ä¸­çš„è·¯å¾„\nsudo cp opendomain.service /etc/systemd/system/\nsudo vim /etc/systemd/system/opendomain.service\n\n# å¯åŠ¨æœåŠ¡\nsudo systemctl daemon-reload\nsudo systemctl enable opendomain\nsudo systemctl start opendomain\nsudo systemctl status opendomain\n```\n\n### æ­¥éª¤ 7: é…ç½® Nginx\n\n```bash\n# å¤åˆ¶é…ç½®\nsudo cp nginx.conf.example /etc/nginx/sites-available/opendomain\nsudo vim /etc/nginx/sites-available/opendomain  # ä¿®æ”¹åŸŸå\n\n# å¯ç”¨é…ç½®\nsudo ln -s /etc/nginx/sites-available/opendomain /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n```\n\n### æ­¥éª¤ 8: é…ç½® SSLï¼ˆå¯é€‰ä½†æ¨èï¼‰\n\n```bash\n# å®‰è£… Certbot\nsudo apt install -y certbot python3-certbot-nginx\n\n# è·å–è¯ä¹¦\nsudo certbot --nginx -d your-domain.com -d www.your-domain.com\n\n# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ\nsudo certbot renew --dry-run\n```\n\n---\n\n## âœ… éªŒè¯éƒ¨ç½²\n\næ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š\n- å‰ç«¯: https://your-domain.com\n- å¥åº·æ£€æŸ¥: https://your-domain.com/api/health\n\næ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š\n```bash\n# æŸ¥çœ‹åº”ç”¨æ—¥å¿—\nsudo journalctl -u opendomain -f\n\n# æŸ¥çœ‹ Nginx æ—¥å¿—\nsudo tail -f /var/log/nginx/opendomain_access.log\n\n# æŸ¥çœ‹è¿›ç¨‹\nps aux | grep opendomain\n```\n\n---\n\n## ğŸ”„ æ›´æ–°éƒ¨ç½²\n\nåç»­æ›´æ–°åªéœ€è¦ï¼š\n\n```bash\ncd /var/www/opendomain\n./deploy.sh\n```\n\n---\n\n## ğŸ“Š å¸¸ç”¨å‘½ä»¤\n\n```bash\n# é‡å¯æœåŠ¡\nsudo systemctl restart opendomain\n\n# æŸ¥çœ‹æ—¥å¿—\nsudo journalctl -u opendomain -n 100 -f\n\n# æŸ¥çœ‹çŠ¶æ€\nsudo systemctl status opendomain\n\n# åœæ­¢æœåŠ¡\nsudo systemctl stop opendomain\n\n# å¤‡ä»½æ•°æ®åº“\npg_dump -U opendomain opendomain > backup_$\\(date +%Y%m%d\\).sql\n\n# æŸ¥çœ‹èµ„æºå ç”¨\nhtop\n```\n\n---\n\n## ğŸ› å¸¸è§é—®é¢˜\n\n### 1. ç«¯å£ 8000 è¢«å ç”¨\n```bash\nsudo netstat -tulpn | grep :8000\n# ä¿®æ”¹ .env ä¸­çš„ PORT\n```\n\n### 2. æ•°æ®åº“è¿æ¥å¤±è´¥\n```bash\nsudo systemctl status postgresql\npsql -h localhost -U opendomain -d opendomain\n```\n\n### 3. å‰ç«¯é¡µé¢ç©ºç™½\n```bash\n# æ£€æŸ¥ Nginx é…ç½®\nsudo nginx -t\n# æ£€æŸ¥å‰ç«¯æ„å»º\nls -la web/dist/\n```\n\n### 4. 502 Bad Gateway\n```bash\n# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ\nsudo systemctl status opendomain\n# æŸ¥çœ‹æ—¥å¿—\nsudo journalctl -u opendomain -n 50\n```\n\n---\n\n## ğŸ“š æ›´å¤šæ–‡æ¡£\n\n- å®Œæ•´éƒ¨ç½²æŒ‡å—: [DEPLOY.md]\\(DEPLOY.md\\)\n- ç¯å¢ƒå˜é‡é…ç½®: [.env.example]\\(.env.example\\)\n- Nginx é…ç½®: [nginx.conf.example]\\(nginx.conf.example\\)\n\n---\n\n## ğŸ†˜ æŠ€æœ¯æ”¯æŒ\n\nå¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š\n1. æŸ¥çœ‹æ—¥å¿—: `sudo journalctl -u opendomain -f`\n2. æ£€æŸ¥ [å¸¸è§é—®é¢˜]\\(DEPLOY.md#å¸¸è§é—®é¢˜\\)\n3. æäº¤ Issue: https://github.com/your-username/opendomain/issues\nEOF)",
      "Bash(/home/jungle/OpenDomain/Dockerfile << 'EOF'\n# å¤šé˜¶æ®µæ„å»º Dockerfile\n\n# ============ é˜¶æ®µ 1: æ„å»ºå‰ç«¯ ============\nFROM node:18-alpine AS frontend-builder\n\nWORKDIR /app/web\n\n# å¤åˆ¶å‰ç«¯ä¾èµ–æ–‡ä»¶\nCOPY web/package*.json ./\n\n# å®‰è£…ä¾èµ–\nRUN npm ci --only=production\n\n# å¤åˆ¶å‰ç«¯æºç \nCOPY web/ ./\n\n# æ„å»ºå‰ç«¯\nRUN npm run build\n\n# ============ é˜¶æ®µ 2: æ„å»ºåç«¯ ============\nFROM golang:1.21-alpine AS backend-builder\n\nWORKDIR /app\n\n# å®‰è£…æ„å»ºä¾èµ–\nRUN apk add --no-cache git gcc musl-dev\n\n# å¤åˆ¶ go mod æ–‡ä»¶\nCOPY go.mod go.sum ./\n\n# ä¸‹è½½ä¾èµ–\nRUN go mod download\n\n# å¤åˆ¶æºä»£ç \nCOPY . .\n\n# ç¼–è¯‘åç«¯ï¼ˆé™æ€é“¾æ¥ï¼‰\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -ldflags=\"-w -s\" -o opendomain ./cmd/api\n\n# ============ é˜¶æ®µ 3: æœ€ç»ˆé•œåƒ ============\nFROM alpine:latest\n\n# å®‰è£…è¿è¡Œæ—¶ä¾èµ–\nRUN apk --no-cache add ca-certificates tzdata curl\n\n# è®¾ç½®æ—¶åŒº\nENV TZ=Asia/Shanghai\n\n# åˆ›å»ºåº”ç”¨ç”¨æˆ·\nRUN addgroup -g 1000 appuser && \\\\\n    adduser -D -u 1000 -G appuser appuser\n\nWORKDIR /app\n\n# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ–‡ä»¶\nCOPY --from=backend-builder /app/opendomain .\nCOPY --from=frontend-builder /app/web/dist ./web/dist\nCOPY --chown=appuser:appuser migrations ./migrations\n\n# åˆ›å»ºæ—¥å¿—ç›®å½•\nRUN mkdir -p logs && chown -R appuser:appuser /app\n\n# åˆ‡æ¢åˆ°é root ç”¨æˆ·\nUSER appuser\n\n# æš´éœ²ç«¯å£\nEXPOSE 8000\n\n# å¥åº·æ£€æŸ¥\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\\\n  CMD curl -f http://localhost:8000/health || exit 1\n\n# å¯åŠ¨åº”ç”¨\nCMD [\"./opendomain\"]\nEOF)",
      "Bash(/home/jungle/OpenDomain/docker-compose.yml << 'EOF'\nversion: '3.8'\n\nservices:\n  # PostgreSQL æ•°æ®åº“\n  postgres:\n    image: postgres:15-alpine\n    container_name: opendomain-postgres\n    restart: unless-stopped\n    environment:\n      POSTGRES_DB: ${DB_NAME:-opendomain}\n      POSTGRES_USER: ${DB_USER:-opendomain}\n      POSTGRES_PASSWORD: ${DB_PASSWORD:-opendomain123}\n      POSTGRES_INITDB_ARGS: \"--encoding=UTF-8 --locale=C\"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"${DB_PORT:-5432}:5432\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${DB_USER:-opendomain}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    networks:\n      - opendomain-network\n\n  # Redis ç¼“å­˜\n  redis:\n    image: redis:7-alpine\n    container_name: opendomain-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-}\n    volumes:\n      - redis_data:/data\n    ports:\n      - \"${REDIS_PORT:-6379}:6379\"\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n    networks:\n      - opendomain-network\n\n  # æ•°æ®åº“è¿ç§»ï¼ˆåˆå§‹åŒ–ï¼‰\n  migrate:\n    image: migrate/migrate:latest\n    container_name: opendomain-migrate\n    depends_on:\n      postgres:\n        condition: service_healthy\n    volumes:\n      - ./migrations:/migrations\n    environment:\n      DATABASE_URL: postgres://${DB_USER:-opendomain}:${DB_PASSWORD:-opendomain123}@postgres:5432/${DB_NAME:-opendomain}?sslmode=disable\n    command: [\"-path\", \"/migrations\", \"-database\", \"${DATABASE_URL}\", \"up\"]\n    networks:\n      - opendomain-network\n    restart: on-failure\n\n  # OpenDomain åº”ç”¨\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: opendomain-app\n    restart: unless-stopped\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      migrate:\n        condition: service_completed_successfully\n    ports:\n      - \"${PORT:-8000}:8000\"\n    environment:\n      # åº”ç”¨é…ç½®\n      APP_ENV: ${APP_ENV:-production}\n      PORT: ${PORT:-8000}\n      LOG_LEVEL: ${LOG_LEVEL:-info}\n      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3001}\n      \n      # ç«™ç‚¹é…ç½®\n      SITE_NAME: ${SITE_NAME:-OpenDomain}\n      SITE_DESCRIPTION: ${SITE_DESCRIPTION:-Free Domain Registration Platform}\n      \n      # æ•°æ®åº“é…ç½®ï¼ˆè¿æ¥åˆ° postgres æœåŠ¡ï¼‰\n      DB_HOST: postgres\n      DB_PORT: 5432\n      DB_USER: ${DB_USER:-opendomain}\n      DB_PASSWORD: ${DB_PASSWORD:-opendomain123}\n      DB_NAME: ${DB_NAME:-opendomain}\n      DB_SSL_MODE: disable\n      \n      # Redis é…ç½®ï¼ˆè¿æ¥åˆ° redis æœåŠ¡ï¼‰\n      REDIS_HOST: redis\n      REDIS_PORT: 6379\n      REDIS_PASSWORD: ${REDIS_PASSWORD:-}\n      REDIS_DB: ${REDIS_DB:-0}\n      \n      # JWT é…ç½®\n      JWT_SECRET: ${JWT_SECRET:-change-this-secret-key}\n      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-2}\n      \n      # PowerDNS é…ç½®\n      POWERDNS_API_URL: ${POWERDNS_API_URL:-http://host.docker.internal:8081}\n      POWERDNS_API_KEY: ${POWERDNS_API_KEY:-}\n      \n      # é‚®ä»¶é…ç½®\n      MAIL_HOST: ${MAIL_HOST:-}\n      MAIL_PORT: ${MAIL_PORT:-587}\n      MAIL_USER: ${MAIL_USER:-}\n      MAIL_PASSWORD: ${MAIL_PASSWORD:-}\n      MAIL_FROM: ${MAIL_FROM:-noreply@opendomain.com}\n      \n      # OAuth é…ç½®\n      GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID:-}\n      GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET:-}\n      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:-}\n      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:-}\n      NODELOC_CLIENT_ID: ${NODELOC_CLIENT_ID:-}\n      NODELOC_CLIENT_SECRET: ${NODELOC_CLIENT_SECRET:-}\n      \n      # æ‰«æå™¨é…ç½®\n      SCANNER_CONCURRENCY: ${SCANNER_CONCURRENCY:-10}\n      SCANNER_TIMEOUT: ${SCANNER_TIMEOUT:-30}\n      \n      # å®‰å…¨æ‰«æ API\n      GOOGLE_SAFE_BROWSING_KEY: ${GOOGLE_SAFE_BROWSING_KEY:-}\n      VIRUSTOTAL_API_KEY: ${VIRUSTOTAL_API_KEY:-}\n      \n      # é»˜è®¤ NS\n      DEFAULT_NS1: ${DEFAULT_NS1:-ns1.example.com}\n      DEFAULT_NS2: ${DEFAULT_NS2:-ns2.example.com}\n      \n      # NodeLoc æ”¯ä»˜\n      NODELOC_PAYMENT_ID: ${NODELOC_PAYMENT_ID:-}\n      NODELOC_SECRET_KEY: ${NODELOC_SECRET_KEY:-}\n      \n      # Telegram Bot\n      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}\n      TELEGRAM_CHANNEL_ID: ${TELEGRAM_CHANNEL_ID:-}\n      \n      # FOSSBilling é›†æˆ\n      FOSSBILLING_ENABLED: ${FOSSBILLING_ENABLED:-false}\n      FOSSBILLING_URL: ${FOSSBILLING_URL:-}\n      FOSSBILLING_ADMIN_API_KEY: ${FOSSBILLING_ADMIN_API_KEY:-}\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - opendomain-network\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰\n  nginx:\n    image: nginx:alpine\n    container_name: opendomain-nginx\n    restart: unless-stopped\n    depends_on:\n      - app\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/conf.d:/etc/nginx/conf.d:ro\n      - ./web/dist:/usr/share/nginx/html:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n      - ./logs/nginx:/var/log/nginx\n    networks:\n      - opendomain-network\n    profiles:\n      - with-nginx\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n\nnetworks:\n  opendomain-network:\n    driver: bridge\nEOF)",
      "Bash(/home/jungle/OpenDomain/.dockerignore << 'EOF'\n# Git\n.git\n.gitignore\n.gitattributes\n\n# ç¯å¢ƒå˜é‡\n.env\n.env.*\n\n# ç¼–è¯‘è¾“å‡º\nopendomain\n*.exe\n*.dll\n*.so\n*.dylib\n\n# æµ‹è¯•å’Œè¦†ç›–\n*.test\n*.out\ncoverage.*\n\n# æ—¥å¿—\nlogs/\n*.log\nnohup.out\n\n# æ•°æ®åº“\n*.db\n*.sqlite*\n\n# IDE\n.idea/\n.vscode/\n*.swp\n*.swo\n*~\n.DS_Store\n\n# Node.js\nnode_modules/\nnpm-debug.log*\nyarn-debug.log*\nweb/dist/\nweb/dist-ssr/\nweb/*.local\n\n# ä¸´æ—¶æ–‡ä»¶\ntmp/\ntemp/\n*.tmp\n*.bak\n*.backup\n\n# Docker\nDockerfile\ndocker-compose*.yml\n.dockerignore\n\n# æ–‡æ¡£\n*.md\n!README.md\ndocs/\n\n# CI/CD\n.github/\n.gitlab-ci.yml\n\n# éƒ¨ç½²è„šæœ¬\ndeploy.sh\ndocker-deploy.sh\n*.service\n\n# å…¶ä»–\ntest-*.sh\nbackup_*\nEOF)",
      "Bash(/home/jungle/OpenDomain/docker-deploy.sh:*)",
      "Bash(/home/jungle/OpenDomain/nginx/conf.d/opendomain.conf << 'EOF'\n# OpenDomain Nginx é…ç½®ï¼ˆDocker ç‰ˆæœ¬ï¼‰\n\nupstream backend {\n    server app:8000;\n}\n\nserver {\n    listen 80;\n    server_name _;\n\n    # æ—¥å¿—\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log;\n\n    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶\n    client_max_body_size 10M;\n\n    # å‰ç«¯é™æ€æ–‡ä»¶\n    location / {\n        root /usr/share/nginx/html;\n        index index.html;\n        try_files $uri $uri/ /index.html;\n\n        # é™æ€èµ„æºç¼“å­˜\n        location ~* \\\\.\\(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp\\)$ {\n            expires 1y;\n            add_header Cache-Control \"public, immutable\";\n        }\n\n        # HTML æ–‡ä»¶ä¸ç¼“å­˜\n        location ~* \\\\.html$ {\n            expires -1;\n            add_header Cache-Control \"no-store, no-cache, must-revalidate\";\n        }\n    }\n\n    # API åå‘ä»£ç†\n    location /api/ {\n        proxy_pass http://backend;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket æ”¯æŒ\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n\n        # è¶…æ—¶è®¾ç½®\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # å¥åº·æ£€æŸ¥\n    location /health {\n        proxy_pass http://backend/health;\n        access_log off;\n    }\n\n    # é˜»æ­¢è®¿é—®éšè—æ–‡ä»¶\n    location ~ /\\\\. {\n        deny all;\n        access_log off;\n        log_not_found off;\n    }\n}\nEOF)",
      "Bash(/home/jungle/OpenDomain/DOCKER-DEPLOY.md << 'EOF'\n# Docker éƒ¨ç½²æŒ‡å—\n\nä½¿ç”¨ Docker å’Œ Docker Compose å¿«é€Ÿéƒ¨ç½² OpenDomainã€‚\n\n## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰\n\n### å‰ç½®è¦æ±‚\n\n- **Docker**: 20.10+ \\([å®‰è£…æŒ‡å—]\\(https://docs.docker.com/get-docker/\\)\\)\n- **Docker Compose**: 2.0+ \\([å®‰è£…æŒ‡å—]\\(https://docs.docker.com/compose/install/\\)\\)\n- **Git**: ç”¨äºå…‹éš†ä»£ç \n\n### ä¸€é”®éƒ¨ç½²\n\n```bash\n# 1. å…‹éš†ä»£ç \ngit clone https://github.com/your-username/opendomain.git\ncd opendomain\n\n# 2. é…ç½®ç¯å¢ƒå˜é‡\ncp .env.example .env\nvim .env  # ä¿®æ”¹å¿…è¦çš„é…ç½®\n\n# 3. ä¸€é”®éƒ¨ç½²\nchmod +x docker-deploy.sh\n./docker-deploy.sh\n```\n\néƒ¨ç½²å®Œæˆåè®¿é—®ï¼š\n- å‰ç«¯: http://localhost:8000\n- å¥åº·æ£€æŸ¥: http://localhost:8000/health\n\n---\n\n## ğŸ“‹ è¯¦ç»†æ­¥éª¤\n\n### 1. å®‰è£… Docker\n\n**Ubuntu/Debian:**\n```bash\n# å®‰è£… Docker\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\n\n# æ·»åŠ å½“å‰ç”¨æˆ·åˆ° docker ç»„\nsudo usermod -aG docker $USER\nnewgrp docker\n\n# éªŒè¯å®‰è£…\ndocker --version\ndocker compose version\n```\n\n**CentOS/RHEL:**\n```bash\nsudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin\nsudo systemctl start docker\nsudo systemctl enable docker\n```\n\n### 2. é…ç½®ç¯å¢ƒå˜é‡\n\n```bash\n# å¤åˆ¶æ¨¡æ¿\ncp .env.example .env\n\n# ç¼–è¾‘é…ç½®\nvim .env\n```\n\n**å¿…é¡»é…ç½®çš„å˜é‡**:\n\n```bash\n# æ•°æ®åº“å¯†ç ï¼ˆè¯·ä¿®æ”¹ä¸ºå¼ºå¯†ç ï¼‰\nDB_PASSWORD=your-secure-password\n\n# JWT å¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼Œè‡³å°‘32ä½ï¼‰\nJWT_SECRET=your-super-secret-jwt-key-at-least-32-chars\n\n# PowerDNS API é…ç½®\nPOWERDNS_API_URL=http://host.docker.internal:8081\nPOWERDNS_API_KEY=your-powerdns-api-key\n\n# å‰ç«¯ URLï¼ˆç”Ÿäº§ç¯å¢ƒåŸŸåï¼‰\nFRONTEND_URL=https://your-domain.com\n\n# é»˜è®¤ NS æœåŠ¡å™¨\nDEFAULT_NS1=ns1.your-domain.com\nDEFAULT_NS2=ns2.your-domain.com\n```\n\n### 3. æ„å»ºå’Œå¯åŠ¨\n\n#### æ–¹å¼ 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰\n\n```bash\nchmod +x docker-deploy.sh\n./docker-deploy.sh\n```\n\n#### æ–¹å¼ 2: ä½¿ç”¨ Docker Compose\n\n```bash\n# æ„å»ºé•œåƒ\ndocker compose build\n\n# å¯åŠ¨æ‰€æœ‰æœåŠ¡\ndocker compose up -d\n\n# æŸ¥çœ‹çŠ¶æ€\ndocker compose ps\n\n# æŸ¥çœ‹æ—¥å¿—\ndocker compose logs -f\n```\n\n---\n\n## ğŸ”§ æœåŠ¡ç»„ä»¶\n\nDocker Compose ä¼šå¯åŠ¨ä»¥ä¸‹æœåŠ¡ï¼š\n\n| æœåŠ¡ | è¯´æ˜ | ç«¯å£ |\n|------|------|------|\n| **app** | OpenDomain åº”ç”¨ | 8000 |\n| **postgres** | PostgreSQL æ•°æ®åº“ | 5432 |\n| **redis** | Redis ç¼“å­˜ | 6379 |\n| **migrate** | æ•°æ®åº“è¿ç§»ï¼ˆä¸€æ¬¡æ€§ï¼‰ | - |\n| **nginx** | Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰ | 80, 443 |\n\n---\n\n## ğŸ“Š å¸¸ç”¨å‘½ä»¤\n\n### æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n\n```bash\n# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡\ndocker compose ps\n\n# æŸ¥çœ‹æœåŠ¡æ—¥å¿—\ndocker compose logs -f\n\n# æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—\ndocker compose logs -f app\ndocker compose logs -f postgres\n```\n\n### å¯åŠ¨å’Œåœæ­¢\n\n```bash\n# å¯åŠ¨æ‰€æœ‰æœåŠ¡\ndocker compose up -d\n\n# åœæ­¢æ‰€æœ‰æœåŠ¡\ndocker compose down\n\n# é‡å¯æœåŠ¡\ndocker compose restart\n\n# é‡å¯æŒ‡å®šæœåŠ¡\ndocker compose restart app\n```\n\n### è¿›å…¥å®¹å™¨\n\n```bash\n# è¿›å…¥åº”ç”¨å®¹å™¨\ndocker compose exec app sh\n\n# è¿›å…¥æ•°æ®åº“å®¹å™¨\ndocker compose exec postgres psql -U opendomain\n\n# æŸ¥çœ‹æ•°æ®åº“\ndocker compose exec postgres psql -U opendomain -d opendomain -c \"SELECT * FROM users;\"\n```\n\n### æ›´æ–°éƒ¨ç½²\n\n```bash\n# æ–¹å¼ 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬\n./docker-deploy.sh --build\n\n# æ–¹å¼ 2: æ‰‹åŠ¨æ›´æ–°\ngit pull\ndocker compose build --no-cache\ndocker compose down\ndocker compose up -d\n```\n\n### æ•°æ®å¤‡ä»½\n\n```bash\n# å¤‡ä»½æ•°æ®åº“\ndocker compose exec postgres pg_dump -U opendomain opendomain > backup_$\\(date +%Y%m%d\\).sql\n\n# æ¢å¤æ•°æ®åº“\ncat backup_20240101.sql | docker compose exec -T postgres psql -U opendomain opendomain\n```\n\n### æ¸…ç†æ•°æ®\n\n```bash\n# åœæ­¢å¹¶åˆ é™¤å®¹å™¨\ndocker compose down\n\n# åœæ­¢å¹¶åˆ é™¤å®¹å™¨å’Œæ•°æ®å·\ndocker compose down -v\n\n# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ\ndocker system prune -a\n```\n\n---\n\n## ğŸŒ ç”Ÿäº§ç¯å¢ƒé…ç½®\n\n### ä½¿ç”¨ Nginx åå‘ä»£ç†\n\nå¯ç”¨ Nginx æœåŠ¡ï¼š\n\n```bash\n# å¯åŠ¨æ—¶åŒ…å« nginx\ndocker compose --profile with-nginx up -d\n\n# é…ç½® Nginx\nvim nginx/conf.d/opendomain.conf\ndocker compose restart nginx\n```\n\n### é…ç½® SSL è¯ä¹¦\n\n**æ–¹å¼ 1: ä½¿ç”¨ Let's Encrypt \\(æ¨è\\)**\n\n```bash\n# å®‰è£… Certbot\nsudo apt install certbot\n\n# è·å–è¯ä¹¦\nsudo certbot certonly --standalone -d your-domain.com\n\n# å¤åˆ¶è¯ä¹¦åˆ°é¡¹ç›®\nsudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem nginx/ssl/\nsudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem nginx/ssl/\n\n# é‡å¯ nginx\ndocker compose restart nginx\n```\n\n**æ–¹å¼ 2: æ‰‹åŠ¨é…ç½®è¯ä¹¦**\n\nå°†è¯ä¹¦æ–‡ä»¶æ”¾åˆ° `nginx/ssl/` ç›®å½•ï¼š\n```\nnginx/ssl/\nâ”œâ”€â”€ fullchain.pem\nâ””â”€â”€ privkey.pem\n```\n\nä¿®æ”¹ `nginx/conf.d/opendomain.conf` æ·»åŠ  SSL é…ç½®ï¼š\n```nginx\nserver {\n    listen 443 ssl http2;\n    server_name your-domain.com;\n    \n    ssl_certificate /etc/nginx/ssl/fullchain.pem;\n    ssl_certificate_key /etc/nginx/ssl/privkey.pem;\n    \n    # ... å…¶ä»–é…ç½®\n}\n```\n\n---\n\n## ğŸ” æ•…éšœæ’æŸ¥\n\n### å®¹å™¨æ— æ³•å¯åŠ¨\n\n```bash\n# æŸ¥çœ‹å®¹å™¨æ—¥å¿—\ndocker compose logs app\n\n# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€\ndocker compose ps -a\n\n# æ£€æŸ¥é…ç½®æ–‡ä»¶\ndocker compose config\n```\n\n### æ•°æ®åº“è¿æ¥å¤±è´¥\n\n```bash\n# æ£€æŸ¥æ•°æ®åº“å®¹å™¨æ˜¯å¦è¿è¡Œ\ndocker compose ps postgres\n\n# æµ‹è¯•æ•°æ®åº“è¿æ¥\ndocker compose exec postgres psql -U opendomain -d opendomain -c \"SELECT 1;\"\n\n# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—\ndocker compose logs postgres\n```\n\n### å‰ç«¯æ— æ³•è®¿é—®\n\n```bash\n# æ£€æŸ¥åº”ç”¨å®¹å™¨ç«¯å£æ˜ å°„\ndocker compose port app 8000\n\n# æ£€æŸ¥é˜²ç«å¢™\nsudo ufw status\nsudo ufw allow 8000/tcp\n\n# æŸ¥çœ‹åº”ç”¨æ—¥å¿—\ndocker compose logs -f app\n```\n\n### ç£ç›˜ç©ºé—´ä¸è¶³\n\n```bash\n# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨\ndocker system df\n\n# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ\ndocker image prune -a\n\n# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨\ndocker container prune\n\n# æ¸…ç†æœªä½¿ç”¨çš„å·\ndocker volume prune\n```\n\n---\n\n## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–\n\n### 1. è°ƒæ•´èµ„æºé™åˆ¶\n\nä¿®æ”¹ `docker-compose.yml`ï¼š\n\n```yaml\nservices:\n  app:\n    deploy:\n      resources:\n        limits:\n          cpus: '2'\n          memory: 2G\n        reservations:\n          cpus: '1'\n          memory: 1G\n```\n\n### 2. ä½¿ç”¨ç”Ÿäº§æ¨¡å¼\n\nç¡®ä¿ `.env` ä¸­è®¾ç½®ï¼š\n```bash\nAPP_ENV=production\nLOG_LEVEL=info\n```\n\n### 3. æ•°æ®åº“ä¼˜åŒ–\n\nåœ¨ `docker-compose.yml` ä¸­æ·»åŠ  PostgreSQL å‚æ•°ï¼š\n\n```yaml\npostgres:\n  command: postgres -c max_connections=200 -c shared_buffers=256MB -c effective_cache_size=1GB\n```\n\n### 4. Redis æŒä¹…åŒ–\n\nå·²å¯ç”¨ AOF æŒä¹…åŒ–ï¼š\n```yaml\nredis:\n  command: redis-server --appendonly yes\n```\n\n---\n\n## ğŸ”’ å®‰å…¨å»ºè®®\n\n1. **ä¿®æ”¹é»˜è®¤å¯†ç **\n   - æ•°æ®åº“å¯†ç \n   - Redis å¯†ç ï¼ˆå¦‚æœå¯ç”¨ï¼‰\n   - JWT å¯†é’¥\n\n2. **é™åˆ¶ç«¯å£è®¿é—®**\n   ```bash\n   # åªæš´éœ²å¿…è¦çš„ç«¯å£\n   # åœ¨ docker-compose.yml ä¸­ç§»é™¤ä¸å¿…è¦çš„ç«¯å£æ˜ å°„\n   ```\n\n3. **ä½¿ç”¨é root ç”¨æˆ·**\n   - Dockerfile å·²é…ç½®ä¸ºä½¿ç”¨ appuser\n\n4. **å®šæœŸæ›´æ–°é•œåƒ**\n   ```bash\n   docker compose pull\n   docker compose up -d\n   ```\n\n5. **é…ç½®é˜²ç«å¢™**\n   ```bash\n   sudo ufw allow 80/tcp\n   sudo ufw allow 443/tcp\n   sudo ufw deny 5432/tcp  # ä¸è¦æš´éœ²æ•°æ®åº“ç«¯å£\n   sudo ufw deny 6379/tcp  # ä¸è¦æš´éœ² Redis ç«¯å£\n   ```\n\n---\n\n## ğŸ¯ é«˜å¯ç”¨éƒ¨ç½²\n\n### Docker Swarm é›†ç¾¤\n\n```bash\n# åˆå§‹åŒ– Swarm\ndocker swarm init\n\n# éƒ¨ç½² Stack\ndocker stack deploy -c docker-compose.yml opendomain\n\n# æŸ¥çœ‹æœåŠ¡\ndocker stack services opendomain\n\n# æ‰©å®¹åº”ç”¨\ndocker service scale opendomain_app=3\n```\n\n### Kubernetes éƒ¨ç½²\n\nå‚è€ƒ `k8s/` ç›®å½•ï¼ˆéœ€è¦å•ç‹¬åˆ›å»ºï¼‰\n\n---\n\n## ğŸ“š ç›¸å…³æ–‡æ¡£\n\n- [Docker å®˜æ–¹æ–‡æ¡£]\\(https://docs.docker.com/\\)\n- [Docker Compose æ–‡æ¡£]\\(https://docs.docker.com/compose/\\)\n- [OpenDomain éƒ¨ç½²æŒ‡å—]\\(DEPLOY.md\\)\n- [å¿«é€Ÿå¼€å§‹]\\(QUICKSTART.md\\)\n\n---\n\n## ğŸ†˜ è·å–å¸®åŠ©\n\n- **æŸ¥çœ‹æ—¥å¿—**: `docker compose logs -f app`\n- **å¥åº·æ£€æŸ¥**: `curl http://localhost:8000/health`\n- **æäº¤ Issue**: https://github.com/your-username/opendomain/issues\nEOF)",
      "Bash(/home/jungle/OpenDomain/docker-compose.dev.yml << 'EOF'\nversion: '3.8'\n\n# å¼€å‘ç¯å¢ƒ Docker Compose é…ç½®\n# ç”¨æ³•: docker compose -f docker-compose.dev.yml up\n\nservices:\n  # PostgreSQL æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n  postgres-dev:\n    image: postgres:15-alpine\n    container_name: opendomain-postgres-dev\n    environment:\n      POSTGRES_DB: opendomain_dev\n      POSTGRES_USER: opendomain\n      POSTGRES_PASSWORD: opendomain123\n    volumes:\n      - postgres_dev_data:/var/lib/postgresql/data\n    ports:\n      - \"5433:5432\"  # ä½¿ç”¨ä¸åŒç«¯å£é¿å…å†²çª\n    networks:\n      - opendomain-dev-network\n\n  # Redisï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n  redis-dev:\n    image: redis:7-alpine\n    container_name: opendomain-redis-dev\n    command: redis-server --appendonly yes\n    volumes:\n      - redis_dev_data:/data\n    ports:\n      - \"6380:6379\"  # ä½¿ç”¨ä¸åŒç«¯å£é¿å…å†²çª\n    networks:\n      - opendomain-dev-network\n\n  # PowerDNSï¼ˆå¼€å‘ç¯å¢ƒ - å¯é€‰ï¼‰\n  powerdns-dev:\n    image: psitrax/powerdns:latest\n    container_name: opendomain-powerdns-dev\n    environment:\n      MYSQL_HOST: mysql-dev\n      MYSQL_USER: powerdns\n      MYSQL_PASS: powerdns123\n      MYSQL_DB: powerdns\n    ports:\n      - \"8081:8081\"  # API\n      - \"5300:53/tcp\"  # DNS TCP\n      - \"5300:53/udp\"  # DNS UDP\n    depends_on:\n      - mysql-dev\n    networks:\n      - opendomain-dev-network\n    profiles:\n      - with-powerdns\n\n  # MySQL for PowerDNSï¼ˆå¼€å‘ç¯å¢ƒï¼‰\n  mysql-dev:\n    image: mariadb:10\n    container_name: opendomain-mysql-dev\n    environment:\n      MYSQL_ROOT_PASSWORD: root123\n      MYSQL_DATABASE: powerdns\n      MYSQL_USER: powerdns\n      MYSQL_PASSWORD: powerdns123\n    volumes:\n      - mysql_dev_data:/var/lib/mysql\n    networks:\n      - opendomain-dev-network\n    profiles:\n      - with-powerdns\n\n  # Adminerï¼ˆæ•°æ®åº“ç®¡ç†å·¥å…·ï¼‰\n  adminer:\n    image: adminer:latest\n    container_name: opendomain-adminer\n    ports:\n      - \"8082:8080\"\n    networks:\n      - opendomain-dev-network\n    profiles:\n      - with-tools\n\nvolumes:\n  postgres_dev_data:\n  redis_dev_data:\n  mysql_dev_data:\n\nnetworks:\n  opendomain-dev-network:\n    driver: bridge\nEOF)"
    ]
  }
}
